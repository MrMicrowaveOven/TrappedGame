<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script type="text/javascript" src='./grid.js'>
    </script>
    <script type="text/javascript" src='./box.js'>
    </script>
    <script type="text/javascript" src='./tile.js'>
    </script>
    <script type="text/javascript" src='./well.js'>
    </script>

    <title>Trapped</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background:url(lab.jpg); background-size: 100% 100%; display: block; margin: 0 auto; }
    </style>
</head>
<body>

<canvas id="myCanvas" width="720" height="480"></canvas>

<script>

// Canvas
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");

  var clickX;
  var clickY;
  //Tile that was just clicked
  var thetile;

  var grid = new Grid();
  var well = new Well();

  var heightOfBoxes = 60;
  var fallSpeed = 2;

  var emptyTileColor = "darkblue";
  var filledTileColor = "red";
  var gridBorderColor = "black";
  var boxBorderColor = "black";
  var boxColor = "red";
  var tileRemovalColor= "yellow";


  // function dropOneBox(thebox) {
  //   killKey = setInterval(function(){
  //     dropping(thebox, killKey)
  //   } , 10);
  // };
  //
  // function dropping(whichbox, killKey) {
  //   well.dropABox(killKey);
  // }

  // dropOneBox(box);

  var gridX = 50;
  var gridY = 50;
  var gridWidth = 400;
  var gridHeight = 400;

  grid.drawGrid(gridX, gridY, gridWidth, gridHeight);

  well.dropABox();

  canvas.addEventListener("mousedown", doMouseDown, false);

  function doMouseDown(event) {


    clickX = event.pageX - canvas.offsetLeft;
    clickY = event.pageY - canvas.offsetTop;

    if (clickX > gridX && clickY > gridY && clickX < gridX + gridWidth && clickY < gridY + gridHeight) {
      thetile = whichtileClicked(clickX, clickY);
      if (thetile !== undefined) {
        thetile.changeValue(boxValue);
        grid.checkForRemovals(thetile);
      }
    }
  }


  function whichtileClicked(clickX, clickY) {
    var clickedtile;
    grid.tiles.forEach(function(tile) {
      if (!tile.filled && clickX > tile.x && clickY > tile.y && clickX < tile.x + tile.width && clickY < tile.y + tile.height) {
        clickedtile = tile;
        boxValue = well.removeABox();
      }
    })
    return clickedtile;
  }
</script>
