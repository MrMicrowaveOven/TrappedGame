<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <script type="text/javascript" src='./grid.js'>
    </script>
    <script type="text/javascript" src='./box.js'>
    </script>
    <script type="text/javascript" src='./tile.js'>
    </script>
    <script type="text/javascript" src='./well.js'>
    </script>
    <script type="text/javascript" src='./flashcards.js'>
    </script>
    <script type="text/javascript" src='./gamemenu.js'>
    </script>

    <title>Trapped</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background:url(lab.jpg); background-size: 100% 100%; display: block; margin: 0 auto; }
    </style>
</head>
<body>
<div justify-content="center">
  <center>
Welcome to my laboratory!  My name is Professor Buttercup, and I could use some help organizing my tiles.
<br>
The tiles will fall from the right side.  Go ahead and place the tiles on the grid there, on the left.
<br>
But don't fill the grid up too much, or I won't have anywhere else to put my tiles!
<br>
So how do you make room for more tiles?  Simple.  If there are ever any two tiles next to each other with the same value (up, down, left, right), BOTH tiles will disappear!
<br>
As time goes by the tiles will fall FASTER, so do arrange them carefully.
<br>
If you fall too far behind, or if the grid fills up completely, it's game over.
  </center>
<br>
</div>
<!-- Love birds?  When they find a mate they fly away! -->


<canvas id="myCanvas" width="720" height="480"></canvas>

<script>

// Canvas
  var canvas = document.getElementById("myCanvas");
  var ctx = canvas.getContext("2d");
  canvas.addEventListener("mousedown", doMouseDown, false);


  var playing = false;
  var clickX;
  var clickY;

  var gameType = "addition";

  //Tile that was just clicked
  var thetile;
  var gameDone = false;

  var gamemenu = new GameMenu();
  var grid = new Grid();
  var well = new Well();

  var heightOfBoxes = 60;
  var fallSpeed = 2;

  var emptyTileColor = "darkblue";
  var filledTileColor = "red";
  var gridBorderColor = "black";
  var boxBorderColor = "black";
  var boxColor = "red";
  var tileRemovalColor= "yellow";

  var gridX = 50;
  var gridY = 50;
  var gridWidth = 400;
  var gridHeight = 400;

  gamemenu.render();

  function play() {
    playing = true;
    ctx.clearRect(0,0,canvas.width, canvas.height);
    grid.drawGrid(gridX, gridY, gridWidth, gridHeight);
    well.dropABox();
  }

  function doMouseDown(event) {
    clickX = event.pageX - canvas.offsetLeft;
    clickY = event.pageY - canvas.offsetTop;
    if (playing === true && clickX > gridX && clickY > gridY && clickX < gridX + gridWidth && clickY < gridY + gridHeight) {
      thetile = whichtileClicked(clickX, clickY);
      if (thetile !== undefined) {
        boxValue = well.removeABox();
        thetile.changeValue(boxValue);
        grid.checkForRemovals(thetile);
      }
    } else if (playing === false && gameDone) {
        if (clickX > 230 && clickX < 280 && clickY > 230 && clickY < 280){
          document.location.reload();
        }
    } else if (playing === false && !gameDone) {
      gamemenu.handleClick(clickX, clickY);
    }
  }

  function whichtileClicked(clickX, clickY) {
    var clickedtile;
    grid.tiles.forEach(function(tile) {
      if (!tile.filled && clickX > tile.x && clickY > tile.y && clickX < tile.x + tile.width && clickY < tile.y + tile.height) {
        clickedtile = tile;
      }
    })
    return clickedtile;
  }


  function gameOver() {
    gameDone = true;
    playing = false;
    ctx.clearRect(0,0,canvas.width, canvas.height);

    ctx.beginPath();
    ctx.rect(0,0,canvas.width, canvas.height);
    ctx.fillStyle = "black";
    ctx.fill();
    ctx.closePath();

    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.fillStyle = "white";
    var title = "Game over!  You scored " + (well.boxCount - 7) + " points!";
    var title2 = "Click the red square to play again!"
    ctx.fillText(title, 230, 150);
    ctx.fillText(title2, 230, 175);

    ctx.beginPath();
    ctx.rect(230, 230, 50, 50);
    ctx.fillStyle = "red";
    ctx.fill();
    ctx.closePath();

  }

</script>
